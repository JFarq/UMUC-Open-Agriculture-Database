<!--

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="graph.js.erb"></script>
<div id="databox"> Graph V 1.1 

</div>-->
<%require 'csv'%>
<%require 'treetop'%>
<%require 'stringio'%>
<%require File.expand_path(File.join(File.dirname(__FILE__), 'node_extensions.rb'))%>

<%
########RUBY PARSER SET UP####################

  
  # Create instance of parser and load parser treetop file
  Treetop.load(File.expand_path(File.join(File.dirname(__FILE__), 'sexp_parser.treetop')))
  @@groParser = SexpParser.new
  
  # Parse an input string and return in a format
  def self.groParse(data)
    
    # Pass the data over to the parser instance
    tree = @@groParser.parse(data)
    
    # If the AST is nil then there was an error during parsing
    # we need to report a simple error message to help the user
   if(tree.nil?)
    raise Exception, "Parse error at offset: #{@@groParser.index}"
   end
    
    # Remove all syntax nodes that aren't one of our custom
    # classes. If we don't do this we will end up with a *lot*
    # of essentially useless nodes
    self.clean_tree(tree)
    
    # Convert the AST into an array representation of the input
    # structure and return it
    return tree.to_array
  end


  
    def self.clean_tree(root_node)
      return if(root_node.elements.nil?)
     root_node.elements.delete_if{|node| node.class.name == "Treetop::Runtime::SyntaxNode" }
      root_node.elements.each {|node| self.clean_tree(node) }
    end
##############################################END PARSER###################
%>
<%
################################RUBY FILE READER###################
header = "Sensor Read", "DAY", "Time", "Sensor", "Sensor Value"

@s = StringIO.new
@s << header
@s << "," << "\n"
gro = "#{Rails.root}/app/views/home/SG_hum50_LODG.gro"

File.open(gro).each do |line|
@s << groParse(line)<< "," << "\n"
end



output = File.open( "#{Rails.root}/app/views/home/outputfile.txt","w" )
output << @s.string
output.close


#################################END FILE LOAD######################
%>
  <div class="col-lg-6 col-lg-offset-3 well" >
    <h3 class="text-center">Grow File Graph</h3>
    </div>

<div id="graphdiv2"
  style="width:500px; height:100px;"></div>
<script type="text/javascript">
  g2 = new Dygraph(
    document.getElementById("graphdiv2"),
    "#{Rails.root}/app/views/home/new.csv", // path to CSV file
    {}          // options
  );
</script>



<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);
      
 var test = <%@s.string%>

     function drawChart() {
         var jsGraph = $({
         url: test,
         dataType:"",
         async: false
         }).responceText
var data = new google.visualization.DataTable(jsGraph);

         

        // var data = new google.visualization.arrayToDataTable(<%@s.string%>);

/*
["Sensor Read", "DAY", "Time", "Sensor", "Sensor Value"],
["Sensor Read 1", 0, ":00:00:00", "SLIN", 0],
["Sensor Read 2", 0, ":00:00:00", "SATM", 26],
["Sensor Read 3", 0, ":18:00:00", "SATM", 23],
["Sensor Read 4", 1, ":00:00:00", "SATM", 26],
["Sensor Read 5", 1, ":18:00:00", "SATM", 23],
["Sensor Read 6", 2, ":00:00:00", "SATM", 26],
["Sensor Read 7", 2, ":18:00:00", "SATM", 23],
["Sensor Read 8", 3, ":00:00:00", "SATM", 26],
["Sensor Read 9", 3, ":18:00:00", "SATM", 23],
["Sensor Read 10", 4, ":00:00:00", "SLIN", 100000],
["Sensor Read 11", 4, ":00:00:00", "SATM", 26],
["Sensor Read 12", 4, ":00:00:00", "SAHU", 50],
["Sensor Read 13", 4, ":18:00:00", "SLIN", 0],
["Sensor Read 14", 4, ":18:00:00", "SATM", 23],
["Sensor Read 15", 5, ":00:00:00", "SLIN", 100000],
["Sensor Read 16", 5, ":00:00:00", "SATM", 26],
["Sensor Read 17", 5, ":18:00:00", "SLIN", 0],
["Sensor Read 18", 5, ":18:00:00", "SATM", 23],
["Sensor Read 19", 6, ":00:00:00", "SLIN", 100000],
["Sensor Read 20", 6, ":00:00:00", "SATM", 26],
["Sensor Read 21", 6, ":18:00:00", "SLIN", 0],
["Sensor Read 22", 6, ":18:00:00", "SATM", 23],
["Sensor Read 23", 7, ":00:00:00", "SLIN", 100000],
["Sensor Read 24", 7, ":00:00:00", "SATM", 26],
["Sensor Read 25", 7, ":18:00:00", "SLIN", 0],
["Sensor Read 26", 7, ":18:00:00", "SATM", 23],
["Sensor Read 27", 8, ":00:00:00", "SLIN", 100000],
["Sensor Read 28", 8, ":00:00:00", "SATM", 26],
["Sensor Read 29", 8, ":18:00:00", "SLIN", 0],
["Sensor Read 30", 8, ":18:00:00", "SATM", 23],
["Sensor Read 31", 9, ":00:00:00", "SLIN", 100000],
["Sensor Read 32", 9, ":00:00:00", "SATM", 26],
["Sensor Read 33", 9, ":18:00:00", "SLIN", 0],
["Sensor Read 34", 9, ":18:00:00", "SATM", 23],
["Sensor Read 35", 10, ":00:00:00", "SLIN", 100000],
["Sensor Read 36", 10, ":00:00:00", "SATM", 26],
["Sensor Read 37", 10, ":18:00:00", "SLIN", 0],
["Sensor Read 38", 10, ":18:00:00", "SATM", 23],
["Sensor Read 39", 11, ":00:00:00", "SLIN", 100000],
["Sensor Read 40", 11, ":00:00:00", "SATM", 26],
["Sensor Read 41", 11, ":18:00:00", "SLIN", 0],
["Sensor Read 42", 11, ":18:00:00", "SATM", 23],
["Sensor Read 43", 12, ":00:00:00", "SLIN", 100000],
["Sensor Read 44", 12, ":00:00:00", "SATM", 26],
["Sensor Read 45", 12, ":18:00:00", "SLIN", 0],
["Sensor Read 46", 12, ":18:00:00", "SATM", 23],
["Sensor Read 47", 13, ":00:00:00", "SLIN", 100000],
["Sensor Read 48", 13, ":00:00:00", "SATM", 26],
["Sensor Read 49", 13, ":18:00:00", "SLIN", 0],
["Sensor Read 50", 13, ":18:00:00", "SATM", 23],
["Sensor Read 51", 14, ":00:00:00", "SLIN", 100000],
["Sensor Read 52", 14, ":00:00:00", "SATM", 26],
["Sensor Read 53", 14, ":18:00:00", "SLIN", 0],
["Sensor Read 54", 14, ":18:00:00", "SATM", 23],
["Sensor Read 55", 15, ":00:00:00", "SLIN", 100000],
["Sensor Read 56", 15, ":00:00:00", "SATM", 26],
["Sensor Read 57", 15, ":18:00:00", "SLIN", 0],
["Sensor Read 58", 15, ":18:00:00", "SATM", 23],
["Sensor Read 59", 16, ":00:00:00", "SLIN", 100000],
["Sensor Read 60", 16, ":00:00:00", "SATM", 26],
["Sensor Read 61", 16, ":18:00:00", "SLIN", 0],
["Sensor Read 62", 16, ":18:00:00", "SATM", 23],
["Sensor Read 63", 17, ":00:00:00", "SLIN", 100000],
["Sensor Read 64", 17, ":00:00:00", "SATM", 26],
["Sensor Read 65", 17, ":18:00:00", "SLIN", 0],
["Sensor Read 66", 17, ":18:00:00", "SATM", 23],
["Sensor Read 67", 18, ":00:00:00", "SLIN", 100000],
["Sensor Read 68", 18, ":00:00:00", "SATM", 26],
["Sensor Read 69", 18, ":18:00:00", "SLIN", 0],
["Sensor Read 70", 18, ":18:00:00", "SATM", 23],
["Sensor Read 71", 19, ":00:00:00", "SLIN", 100000],
["Sensor Read 72", 19, ":00:00:00", "SATM", 26],
["Sensor Read 73", 19, ":18:00:00", "SLIN", 0],
["Sensor Read 74", 19, ":18:00:00", "SATM", 23],
["Sensor Read 75", 20, ":00:00:00", "SLIN", 100000],
["Sensor Read 76", 20, ":00:00:00", "SATM", 26],
["Sensor Read 77", 20, ":18:00:00", "SLIN", 0],
["Sensor Read 78", 20, ":18:00:00", "SATM", 23],
["Sensor Read 79", 21, ":00:00:00", "SLIN", 100000],
["Sensor Read 80", 21, ":00:00:00", "SATM", 26],
["Sensor Read 81", 21, ":18:00:00", "SLIN", 0],
["Sensor Read 82", 21, ":18:00:00", "SATM", 23],
["Sensor Read 83", 22, ":00:00:00", "SLIN", 100000],
["Sensor Read 84", 22, ":00:00:00", "SATM", 26],
["Sensor Read 85", 22, ":18:00:00", "SLIN", 0],
["Sensor Read 86", 22, ":18:00:00", "SATM", 23],
["Sensor Read 87", 23, ":00:00:00", "SLIN", 100000],
["Sensor Read 88", 23, ":00:00:00", "SATM", 26],
["Sensor Read 89", 23, ":18:00:00", "SLIN", 0],
["Sensor Read 90", 23, ":18:00:00", "SATM", 23],
["Sensor Read 91", 24, ":00:00:00", "SLIN", 100000],
["Sensor Read 92", 24, ":00:00:00", "SATM", 26],
["Sensor Read 93", 24, ":18:00:00", "SLIN", 0],
["Sensor Read 94", 24, ":18:00:00", "SATM", 23],
["Sensor Read 95", 25, ":00:00:00", "SLIN", 100000],
["Sensor Read 96", 25, ":00:00:00", "SATM", 26],
["Sensor Read 97", 25, ":18:00:00", "SLIN", 0],
["Sensor Read 98", 25, ":18:00:00", "SATM", 23],
["Sensor Read 99", 26, ":00:00:00", "SLIN", 100000],
["Sensor Read 100", 26, ":00:00:00", "SATM", 26],
["Sensor Read 101", 26, ":18:00:00", "SLIN", 0],
["Sensor Read 102", 26, ":18:00:00", "SATM", 23],
["Sensor Read 103", 27, ":00:00:00", "SLIN", 100000],
["Sensor Read 104", 27, ":00:00:00", "SATM", 26],
["Sensor Read 105", 27, ":18:00:00", "SLIN", 0],
["Sensor Read 106", 27, ":18:00:00", "SATM", 23],
["Sensor Read 107", 28, ":00:00:00", "SLIN", 100000],
["Sensor Read 108", 28, ":00:00:00", "SATM", 26],
["Sensor Read 109", 28, ":18:00:00", "SLIN", 0],
["Sensor Read 110", 28, ":18:00:00", "SATM", 23],
["Sensor Read 111", 29, ":00:00:00", "SLIN", 100000],
["Sensor Read 112", 29, ":00:00:00", "SATM", 26],
["Sensor Read 113", 29, ":18:00:00", "SLIN", 0],
["Sensor Read 114", 29, ":18:00:00", "SATM", 23],
["Sensor Read 115", 30, ":00:00:00", "SLIN", 100000],
["Sensor Read 116", 30, ":00:00:00", "SATM", 26],
["Sensor Read 117", 30, ":18:00:00", "SLIN", 0],
["Sensor Read 118", 30, ":18:00:00", "SATM", 23],
["Sensor Read 119", 31, ":00:00:00", "SLIN", 100000],
["Sensor Read 120", 31, ":00:00:00", "SATM", 26],
["Sensor Read 121", 31, ":18:00:00", "SLIN", 0],
["Sensor Read 122", 31, ":18:00:00", "SATM", 23],
["Sensor Read 123", 32, ":00:00:00", "SLIN", 100000],
["Sensor Read 124", 32, ":00:00:00", "SATM", 26],
["Sensor Read 125", 32, ":18:00:00", "SLIN", 0],
["Sensor Read 126", 32, ":18:00:00", "SATM", 23],
["Sensor Read 127", 33, ":00:00:00", "SLIN", 100000],
["Sensor Read 128", 33, ":00:00:00", "SATM", 26],
["Sensor Read 129", 33, ":18:00:00", "SLIN", 0],
["Sensor Read 130", 33, ":18:00:00", "SATM", 23],
["Sensor Read 131", 34, ":00:00:00", "SLIN", 100000],
["Sensor Read 132", 34, ":00:00:00", "SATM", 26],
["Sensor Read 133", 34, ":18:00:00", "SLIN", 0],
["Sensor Read 134", 34, ":18:00:00", "SATM", 23],
["Sensor Read 135", 35, ":00:00:00", "SLIN", 100000],
["Sensor Read 136", 35, ":00:00:00", "SATM", 26],
["Sensor Read 137", 35, ":18:00:00", "SLIN", 0],
["Sensor Read 138", 35, ":18:00:00", "SATM", 23],
["Sensor Read 139", 36, ":00:00:00", "SLIN", 100000],
["Sensor Read 140", 36, ":00:00:00", "SATM", 26],
["Sensor Read 141", 36, ":18:00:00", "SLIN", 0],
["Sensor Read 142", 36, ":18:00:00", "SATM", 23],
["Sensor Read 143", 37, ":00:00:00", "SLIN", 100000],
["Sensor Read 144", 37, ":00:00:00", "SATM", 26],
["Sensor Read 145", 37, ":18:00:00", "SLIN", 0],
["Sensor Read 146", 37, ":18:00:00", "SATM", 23],
["Sensor Read 147", 38, ":00:00:00", "SLIN", 100000],
["Sensor Read 148", 38, ":00:00:00", "SATM", 26],
["Sensor Read 149", 38, ":18:00:00", "SLIN", 0],
["Sensor Read 150", 38, ":18:00:00", "SATM", 23],
["Sensor Read 151", 39, ":00:00:00", "SLIN", 100000],
["Sensor Read 152", 39, ":00:00:00", "SATM", 26],
["Sensor Read 153", 39, ":18:00:00", "SLIN", 0],
["Sensor Read 154", 39, ":18:00:00", "SATM", 23],
["Sensor Read 155", 40, ":00:00:00", "SLIN", 100000],
["Sensor Read 156", 40, ":00:00:00", "SATM", 26],
["Sensor Read 157", 40, ":18:00:00", "SLIN", 0],
["Sensor Read 158", 40, ":18:00:00", "SATM", 23],
["Sensor Read 159", 41, ":00:00:00", "SLIN", 100000],
["Sensor Read 160", 41, ":00:00:00", "SATM", 26],
["Sensor Read 161", 41, ":18:00:00", "SLIN", 0],
["Sensor Read 162", 41, ":18:00:00", "SATM", 23],
["Sensor Read 163", 42, ":00:00:00", "SLIN", 100000],
["Sensor Read 164", 42, ":00:00:00", "SATM", 26],
["Sensor Read 165", 42, ":18:00:00", "SLIN", 0],
["Sensor Read 166", 42, ":18:00:00", "SATM", 23],
["Sensor Read 167", 43, ":00:00:00", "SLIN", 100000],
["Sensor Read 168", 43, ":00:00:00", "SATM", 26],
["Sensor Read 169", 43, ":18:00:00", "SLIN", 0],
["Sensor Read 170", 43, ":18:00:00", "SATM", 23],
["Sensor Read 171", 44, ":00:00:00", "SLIN", 100000],
["Sensor Read 172", 44, ":00:00:00", "SATM", 26],
["Sensor Read 173", 44, ":18:00:00", "SLIN", 0],
["Sensor Read 174", 44, ":18:00:00", "SATM", 23],
["Sensor Read 175", 45, ":00:00:00", "SLIN", 100000],
["Sensor Read 176", 45, ":00:00:00", "SATM", 26],
["Sensor Read 177", 45, ":18:00:00", "SLIN", 0],
["Sensor Read 178", 45, ":18:00:00", "SATM", 23],
["Sensor Read 179", 46, ":00:00:00", "SLIN", 100000],
["Sensor Read 180", 46, ":00:00:00", "SATM", 26],
["Sensor Read 181", 46, ":18:00:00", "SLIN", 0],
["Sensor Read 182", 46, ":18:00:00", "SATM", 23],
["Sensor Read 183", 47, ":00:00:00", "SLIN", 100000],
["Sensor Read 184", 47, ":00:00:00", "SATM", 26],
["Sensor Read 185", 47, ":18:00:00", "SLIN", 0],
["Sensor Read 186", 47, ":18:00:00", "SATM", 23],
["Sensor Read 187", 48, ":00:00:00", "SLIN", 100000],
["Sensor Read 188", 48, ":00:00:00", "SATM", 26],
["Sensor Read 189", 48, ":18:00:00", "SLIN", 0],
["Sensor Read 190", 48, ":18:00:00", "SATM", 23],
["Sensor Read 191", 49, ":00:00:00", "SLIN", 100000],
["Sensor Read 192", 49, ":00:00:00", "SATM", 26],
["Sensor Read 193", 49, ":18:00:00", "SLIN", 0],
["Sensor Read 194", 49, ":18:00:00", "SATM", 23],
["Sensor Read 195", 50, ":00:00:00", "SLIN", 100000],
["Sensor Read 196", 50, ":00:00:00", "SATM", 26],
["Sensor Read 197", 50, ":18:00:00", "SLIN", 0],
["Sensor Read 198", 50, ":18:00:00", "SATM", 23],
["Sensor Read 199", 51, ":00:00:00", "SLIN", 100000],
["Sensor Read 200", 51, ":00:00:00", "SATM", 26],
["Sensor Read 201", 51, ":18:00:00", "SLIN", 0],
["Sensor Read 202", 51, ":18:00:00", "SATM", 23],
["Sensor Read 203", 52, ":00:00:00", "SLIN", 100000],
["Sensor Read 204", 52, ":00:00:00", "SATM", 26],
["Sensor Read 205", 52, ":18:00:00", "SLIN", 0],
["Sensor Read 206", 52, ":18:00:00", "SATM", 23],
["Sensor Read 207", 53, ":00:00:00", "SLIN", 100000],
["Sensor Read 208", 53, ":00:00:00", "SATM", 26],
["Sensor Read 209", 53, ":18:00:00", "SLIN", 0],
["Sensor Read 210", 53, ":18:00:00", "SATM", 23],
["Sensor Read 211", 54, ":00:00:00", "SLIN", 100000],
["Sensor Read 212", 54, ":00:00:00", "SATM", 26],
["Sensor Read 213", 54, ":18:00:00", "SLIN", 0],
["Sensor Read 214", 54, ":18:00:00", "SATM", 23],
["Sensor Read 215", 55, ":00:00:00", "SLIN", 100000],
["Sensor Read 216", 55, ":00:00:00", "SATM", 26],
["Sensor Read 217", 55, ":18:00:00", "SLIN", 0],
["Sensor Read 218", 55, ":18:00:00", "SATM", 23],
["Sensor Read 219", 56, ":00:00:00", "SLIN", 100000],
["Sensor Read 220", 56, ":00:00:00", "SATM", 26],
["Sensor Read 221", 56, ":18:00:00", "SLIN", 0],
["Sensor Read 222", 56, ":18:00:00", "SATM", 23],
["Sensor Read 223", 57, ":00:00:00", "SLIN", 100000],
["Sensor Read 224", 57, ":00:00:00", "SATM", 26],
["Sensor Read 225", 57, ":18:00:00", "SLIN", 0],
["Sensor Read 226", 57, ":18:00:00", "SATM", 23],
["Sensor Read 227", 58, ":00:00:00", "SLIN", 100000],
["Sensor Read 228", 58, ":00:00:00", "SATM", 26],
["Sensor Read 229", 58, ":18:00:00", "SLIN", 0],
["Sensor Read 230", 58, ":18:00:00", "SATM", 23],
["Sensor Read 231", 59, ":00:00:00", "SLIN", 100000],
["Sensor Read 232", 59, ":00:00:00", "SATM", 26],
["Sensor Read 233", 59, ":18:00:00", "SLIN", 0],
["Sensor Read 234", 59, ":18:00:00", "SATM", 23],
["Sensor Read 235", 60, ":00:00:00", "GHAR", 0],


]);*/

        var options = {
          title: 'Simple Greens recipe',
          vAxis: {title: 'Over Time'},
          isStacked: true
        };

        var chart = new google.visualization.PieChart(document.getElementById('chart_div'));

       chart.draw(data, {showRowNumber: true, width: '100%', height: '100%'});
      }
    </script>

  
 <div id = "chart_div" width="200" height="200" align="middle" >
<%=t( @s.string.html_safe)%>
</div>
